title: HA1 Debug
icon: mdi:test-tube

views:
  - title: HA1 Debug
    path: ha1-debug
    icon: mdi:test-tube
    panel: true
    cards:
      - type: vertical-stack
        cards:

          - type: markdown
            content: |
              # üß™ HA1.3 Debug Dashboard
              Live monitoring of Task 14 template sensors ‚Äî raw powers, HA1 power layer, flows and sanity checks.

          # Key snapshot (HA1 power layer)
          - type: entities
            title: üîå Key Snapshot (HA1 Power Layer)
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_power_grid_total_net
                name: Grid Total (net, +import)
              - entity: sensor.ha1_power_solar_ac
                name: Solar AC (PV)
              - entity: sensor.ha1_power_battery_net
                name: Battery Net (+charge / -discharge)
              - entity: sensor.ha1_power_ev_charger
                name: EV Charger Power
              - entity: sensor.ha1_power_house_core
                name: House Core (no EV)
              - entity: sensor.ha1_power_house_total
                name: House Total (incl. EV)

          # Raw sensors
          - type: entities
            title: üîé Key Snapshot Raw Sensors
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_raw_grid_import_w
                name: Grid Import (Easee)
              - entity: sensor.ha1_raw_grid_export_w
                name: Grid Export (Easee)
              - entity: sensor.ha1_raw_ev_charger_w
                name: Easee Charger (raw)
              - entity: sensor.ha1_raw_battery_power_w
                name: Battery Charge/Discharge (raw)
              - entity: sensor.ha1_raw_solar_pv_input_w
                name: Inverter Input Power (PV)
              - entity: sensor.ha1_raw_huawei_meter_w
                name: Huawei Power Meter (diagnostic)

          # Power layer (final values)
          - type: entities
            title: ‚ö° Power Layer (ha1_power_*)
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_power_grid_total_net
                name: Grid Net (Total)
              - entity: sensor.ha1_power_solar_ac
                name: Solar AC
              - entity: sensor.ha1_power_battery_net
                name: Battery Net
              - entity: sensor.ha1_power_ev_charger
                name: EV Charger Power
              - entity: sensor.ha1_power_house_core
                name: House Core
              - entity: sensor.ha1_power_house_total
                name: House Total

          # Flow layer
          - type: entities
            title: üîÄ Flow Layer (ha1_flow_*)
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_flow_grid_import
                name: Grid Import
              - entity: sensor.ha1_flow_grid_export
                name: Grid Export
              - entity: sensor.ha1_flow_ev_charging_power
                name: EV Charging Power
              - entity: sensor.ha1_flow_battery_discharge
                name: Battery Discharge

          # Sanity check section
          - type: markdown
            content: |
              ## üß© Sanity Checks
              **Model balance** uses the HA1-normalised powers > grid_total, solar, battery, house_total.  
              **Grid meter mismatch** compares the Huawei meter against the modelled grid power.

          # Model balance
          - type: entities
            title: Model Balance
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_power_balance_error
                name: Model Balance Error (W)
              - entity: sensor.ha1_power_balance_error_abs
                name: Model Balance Error Absolute (W)
              - entity: binary_sensor.ha1_flag_power_balance_bad
                name: Model Balance Problem?

          # Grid meter mismatch
          - type: entities
            title: Grid Meter Mismatch
            show_header_toggle: false
            entities:
              - entity: sensor.ha1_grid_meter_mismatch
                name: Meter Minus Model (W)
              - entity: sensor.ha1_grid_meter_mismatch_abs
                name: Meter Minus Model Absolute (W)
              - entity: binary_sensor.ha1_flag_grid_meter_mismatch
                name: Grid Meter Mismatch?

          # Core power trends (short window)
          - type: history-graph
            title: üìà Core Powers ‚Äì last 1 hour
            hours_to_show: 1
            refresh_interval: 30
            entities:
              - entity: sensor.ha1_power_grid_total_net
                name: Grid Net (+import / -export)
              - entity: sensor.ha1_power_solar_ac
                name: Solar AC
              - entity: sensor.ha1_power_battery_net
                name: Battery Net (+charge / -discharge)
              - entity: sensor.ha1_power_ev_charger
                name: EV Charger
              - entity: sensor.ha1_power_house_total
                name: House Total

          # Flows & sanity trends (longer window)
          - type: history-graph
            title: üìä Flows & Balance ‚Äì last 24 hours
            hours_to_show: 24
            refresh_interval: 60
            entities:
              - entity: sensor.ha1_flow_grid_import
                name: Grid Import
              - entity: sensor.ha1_flow_grid_export
                name: Grid Export
              - entity: sensor.ha1_flow_ev_charging_power
                name: EV Charging Power
              - entity: sensor.ha1_flow_battery_discharge
                name: Battery Discharge
              - entity: sensor.ha1_power_balance_error_abs
                name: Model Balance Error |abs|

          # Control tools ‚Äì master switches & knobs
          - type: entities
            title: ‚öôÔ∏è Control Tools ‚Äì Master Toggles & Targets
            show_header_toggle: false
            entities:
              - entity: input_boolean.ha1_control_ev_auto
                name: EV Charging ‚Äì automation enabled
              - entity: input_boolean.ha1_control_battery_auto
                name: Battery Optimization ‚Äì automation enabled
              - type: divider
              - entity: input_number.ha1_ev_limit_current_a
                name: EV Max Current (A)
              - entity: input_number.ha1_batt_grid_charge_max_kw
                name: Battery Grid Charge Max (kW)
              - entity: input_number.ha1_batt_peak_shaving_soc
                name: Battery Peak-Shaving Target SOC (%)
              - entity: input_number.ha1_batt_grid_charge_cutoff_soc
                name: Battery Grid Charge Cutoff SOC (%)

          # Control tools ‚Äì EV scripts
          - type: entities
            title: üöó EV Control ‚Äì Scripts
            show_header_toggle: false
            entities:
              - entity: script.ha1_ev_start_charging
                name: Start EV Charging
              - entity: script.ha1_ev_stop_charging
                name: Stop EV Charging
              - entity: script.ha1_ev_pause_charging
                name: Pause EV Charging
              - entity: script.ha1_ev_resume_charging
                name: Resume EV Charging
              - entity: script.ha1_ev_override_schedule
                name: Override Schedule
              - entity: script.ha1_ev_set_dynamic_current_from_helper
                name: Apply EV Dynamic Current from Helper

          # Control tools ‚Äì Battery scripts
          - type: entities
            title: üîã Battery Control ‚Äì Scripts
            show_header_toggle: false
            entities:
              - entity: script.ha1_batt_enable_grid_charge
                name: Enable Grid Charge
              - entity: script.ha1_batt_disable_grid_charge
                name: Disable Grid Charge
              - type: divider
              - entity: script.ha1_batt_apply_peak_shaving_soc
                name: Apply Peak-Shaving SOC from Helper
              - entity: script.ha1_batt_apply_grid_charge_cutoff_soc
                name: Apply Grid Charge Cutoff SOC from Helper
          - entity: script.ha1_batt_apply_grid_charge_limit
            name: Apply Grid Charge Max (kW) from Helper
          - entity: script.ha1_batt_set_peak_shaving_mode
            name: Set Working Mode = Peak Shaving

  - title: HA1 Debug ‚Äì Energy
    path: ha1-debug-energy
    icon: mdi:lightning-bolt-outline
    cards:
      - type: markdown
        content: |
          # ‚öôÔ∏è HA1 Debug ‚Äì Energy Layer
          Engineering view for Task 19 ‚Äî core HA1 flows, utility meters, helpers and diagnostic groupings. Everything is surfaced as raw data for troubleshooting.

      - type: entities
        title: üîå Core Power & Flow Snapshot
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_power_grid_total_net
            name: Grid Net (W, +import)
          - entity: sensor.ha1_power_net_load_kw
            name: Grid Net (kW)
          - entity: sensor.ha1_flow_grid_import
            name: Grid Import Flow (W)
          - entity: sensor.ha1_flow_grid_export
            name: Grid Export Flow (W)
          - type: divider
          - entity: sensor.ha1_power_solar_ac
            name: Solar AC Output (W)
          - entity: sensor.ha1_power_house_total
            name: House Total Load (W)
          - entity: sensor.ha1_power_consumption_total_kw
            name: House Total Load (kW)
          - entity: sensor.ha1_power_house_core
            name: House Core Load (W)
          - type: divider
          - entity: sensor.ha1_power_ev_charger
            name: EV Charger Power (W)
          - entity: sensor.ha1_flow_ev_charging_power
            name: EV Charging Flow (W)
          - entity: sensor.ha1_power_battery_net
            name: Battery Net (+charge / -discharge)
          - entity: sensor.ha1_flow_battery_discharge
            name: Battery Discharge Flow (W)

      - type: entities
        title: üìä Rolling Averages & Smoothing
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_power_grid_net_avg_1m
            name: Grid Net Avg (1 min)
          - entity: sensor.ha1_power_grid_net_avg_5m
            name: Grid Net Avg (5 min)
          - entity: sensor.ha1_flow_grid_import_avg_1m
            name: Grid Import Avg (1 min)
          - entity: sensor.ha1_flow_grid_import_avg_5m
            name: Grid Import Avg (5 min)
          - entity: sensor.ha1_flow_grid_export_avg_1m
            name: Grid Export Avg (1 min)
          - entity: sensor.ha1_flow_grid_export_avg_5m
            name: Grid Export Avg (5 min)
          - type: divider
          - entity: sensor.ha1_power_house_total_avg_1m
            name: House Load Avg (1 min)
          - entity: sensor.ha1_power_ev_charger_avg_1m
            name: EV Charger Avg (1 min)

      - type: entities
        title: üèóÔ∏è Diagnostics ‚Äì Grid (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_import_power
            name: Grid Import Power
          - entity: sensor.ha1_export_power
            name: Grid Export Power
          - entity: sensor.ha1_net_grid_power
            name: Net Grid Power (W)
          - entity: sensor.ha1_net_grid_power_kw
            name: Net Grid Power (kW)
          - entity: sensor.ha1_grid_status
            name: Grid Status Label
          - type: divider
          - entity: sensor.ha1_import_energy_15min
            name: Import Energy (15 min)
          - entity: sensor.ha1_import_energy_hourly
            name: Import Energy (Hourly)
          - entity: sensor.ha1_import_energy_daily
            name: Import Energy (Daily)
          - entity: sensor.ha1_import_energy_monthly
            name: Import Energy (Monthly)
          - type: divider
          - entity: sensor.ha1_interval_power_real
            name: Interval Power (Real)
          - entity: sensor.ha1_interval_power_cost_adjusted
            name: Interval Power (Cost Adjusted)
          - entity: sensor.ha1_monthly_peak_power_real_history_max_2
            name: Monthly Peak Power (Real)
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Monthly Peak Power (Cost Adjusted)

      - type: entities
        title: ‚òÄÔ∏è Diagnostics ‚Äì Solar & Battery (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.huawei_solar_input_power
            name: Huawei Solar Input Power
          - entity: sensor.huawei_solar_output_power
            name: Huawei Solar Output Power
          - entity: sensor.huawei_battery_charge_discharge_power
            name: Huawei Battery Charge/Discharge
          - entity: sensor.huawei_battery_soc
            name: Huawei Battery SOC (%)
          - type: divider
          - entity: sensor.ha1_flow_solar_to_house
            name: Flow ‚Äì Solar to House
          - entity: sensor.ha1_flow_solar_to_battery
            name: Flow ‚Äì Solar to Battery
          - entity: sensor.ha1_flow_battery_to_house
            name: Flow ‚Äì Battery to House
          - entity: sensor.ha1_flow_house_from_grid
            name: Flow ‚Äì House From Grid
          - entity: sensor.ha1_flow_ev_from_grid
            name: Flow ‚Äì EV From Grid

      - type: entities
        title: üöó Diagnostics ‚Äì EV & Charger (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.ehxdyl83_power
            name: Easee Power (kW/W)
          - entity: sensor.ehxdyl83_status
            name: Easee Status
          - entity: sensor.ehxdyl83_session_energy
            name: Easee Session Energy
          - entity: sensor.ehxdyl83_lifetime_energy
            name: Easee Lifetime Energy
          - entity: switch.ehxdyl83_charger_enabled
            name: Charger Enabled
          - type: divider
          - entity: sensor.id4pro_charging_time_left
            name: ID.4 Charging Time Left
          - entity: binary_sensor.ev_is_charging
            name: ID.4 Charging?
          - entity: sensor.id4pro_battery_level
            name: ID.4 Battery Level (%)
          - entity: sensor.ha1_flow_ev_from_grid
            name: Flow ‚Äì EV From Grid

      - type: entities
        title: üí∞ Diagnostics ‚Äì Prices (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.nordpool_kwh_se3_sek_3_10_025
            name: Nordpool SE3 Price
          - entity: sensor.ha1_price_current
            name: HA1 Price Current
          - entity: sensor.ha1_price_today_avg
            name: Price Today Avg
          - entity: sensor.ha1_price_today_min
            name: Price Today Min
          - entity: sensor.ha1_price_today_max
            name: Price Today Max
          - entity: sensor.ha1_status_price_level
            name: Price Level (cheap/normal/expensive)
          - entity: sensor.ha1_status_price_relative
            name: Price Relative (% vs avg)

      - type: entities
        title: üì¶ Utility Meters & Peak Tracking
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_grid_import_energy_daily
            name: Grid Import Energy ‚Äì Daily
          - entity: sensor.ha1_grid_import_energy_weekly
            name: Grid Import Energy ‚Äì Weekly
          - entity: sensor.ha1_grid_import_energy_monthly
            name: Grid Import Energy ‚Äì Monthly
          - entity: sensor.ha1_grid_import_energy_hourly
            name: Grid Import Energy ‚Äì Hourly
          - entity: sensor.ha1_grid_import_energy_quarter_hour
            name: Grid Import Energy ‚Äì 15 min
          - type: divider
          - entity: sensor.ha1_grid_export_energy_daily
            name: Grid Export Energy ‚Äì Daily
          - entity: sensor.ha1_grid_export_energy_weekly
            name: Grid Export Energy ‚Äì Weekly
          - entity: sensor.ha1_grid_export_energy_monthly
            name: Grid Export Energy ‚Äì Monthly
          - type: divider
          - entity: sensor.ha1_peak_billable_power_kw
            name: Peak Billable Power (kW)
          - entity: sensor.ha1_peak_power_interval_real
            name: Peak Power Interval (Real)
          - entity: sensor.ha1_peak_power_interval_cost_adjusted
            name: Peak Power Interval (Cost Adjusted)
          - entity: sensor.ha1_effective_peak_power_reference_kw
            name: Effective Peak Reference (kW)
          - entity: sensor.ha1_peak_margin_kw
            name: Peak Margin (kW)
          - entity: sensor.ha1_peak_billing_factor
            name: Peak Billing Factor
          - entity: sensor.ha1_import_energy_current_interval
            name: Import Energy ‚Äì Current Interval
          - entity: sensor.ha1_peak_interval_length_hours
            name: Peak Interval Length (h)
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Monthly Peak Power (Cost Adjusted Top3)
          - entity: sensor.ha1_monthly_peak_cost_estimated
            name: Monthly Peak Cost (SEK)

      - type: entities
        title: üìà Diagnostics ‚Äì Peaks & Top 3 (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_interval_length_minutes
            name: Interval Length (minutes)
          - entity: sensor.ha1_interval_energy
            name: Interval Energy (kWh)
          - entity: sensor.ha1_interval_power_real
            name: Interval Power (Real)
          - entity: sensor.ha1_interval_power_cost_adjusted
            name: Interval Power (Cost Adjusted)
          - type: divider
          - entity: sensor.ha1_top3_peak_1
            name: Top #1 Peak (kW)
          - entity: sensor.ha1_top3_peak_2
            name: Top #2 Peak (kW)
          - entity: sensor.ha1_top3_peak_3
            name: Top #3 Peak (kW)
          - entity: sensor.ha1_monthly_top3_avg_power_real
            name: Monthly Avg Peak (Real)
          - entity: sensor.ha1_monthly_top3_avg_power_cost_adjusted
            name: Monthly Avg Peak (Cost Adjusted)
          - entity: sensor.ha1_monthly_peak_power_real_history_max_2
            name: Monthly Peak Power (Real)
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Monthly Peak Power (Cost Adjusted)

      - type: entities
        title: üéöÔ∏è Helper Controls ‚Äì Peaks & Modes
        show_header_toggle: false
        entities:
          - entity: input_boolean.ha1_automation_master_enabled
            name: Automation Master Enable
          - entity: input_boolean.ha1_peak_shaving_enabled
            name: Peak Shaving Enabled
          - entity: input_select.ha1_peak_interval_mode
            name: Peak Interval Mode
          - entity: input_number.ha1_peak_limit_kw
            name: Peak Limit (kW)
          - entity: input_number.ha1_peak_warning_kw
            name: Peak Warning Threshold (kW)
          - entity: input_number.ha1_daily_peak_power_cost_adjusted
            name: Daily Peak (Cost Adjusted)
          - type: divider
          - entity: input_boolean.ha1_control_battery_auto
            name: Battery Automations Enabled
          - entity: input_boolean.ha1_control_ev_auto
            name: EV Automations Enabled
          - entity: input_boolean.ha1_ev_obey_peak_limit
            name: EV Obeys Peak Limit
          - entity: input_select.ha1_ev_charging_mode
            name: EV Charging Mode
          - entity: input_number.ha1_ev_limit_current_a
            name: EV Current Limit (A)
          - entity: input_number.ha1_ev_max_charging_power_kw
            name: EV Max Charging Power (kW)

      - type: entities
        title: ü™´ Helper Controls ‚Äì SOC, Comfort & Overrides
        show_header_toggle: false
        entities:
          - entity: input_boolean.ha1_battery_allow_grid_charge
            name: Allow Battery Grid Charge
          - entity: input_boolean.ha1_battery_peak_support_enabled
            name: Battery Peak Support Enabled
          - entity: input_boolean.ha1_force_battery_charge_from_grid_now
            name: Force Battery Grid Charge Now
          - entity: input_boolean.ha1_force_ev_charge_now
            name: Force EV Charge Now
          - type: divider
          - entity: input_number.ha1_battery_min_soc_normal
            name: Battery Min SOC (Normal)
          - entity: input_number.ha1_battery_max_soc_target
            name: Battery Max SOC Target
          - entity: input_number.ha1_batt_peak_shaving_soc
            name: Battery Peak Shaving SOC (%)
          - entity: input_number.ha1_batt_grid_charge_cutoff_soc
            name: Battery Grid Charge Cutoff SOC (%)
          - entity: input_number.ha1_batt_grid_charge_max_kw
            name: Battery Grid Charge Max (kW)
          - type: divider
          - entity: input_boolean.ha1_comfort_override_enabled
            name: Comfort Override Enabled
          - entity: input_boolean.ha1_allow_high_price_heating
            name: Allow High Price Heating
          - entity: input_boolean.ha1_debug_energy_logic
            name: Debug Energy Logic
          - entity: input_boolean.ha1_debug_notifications_enabled
            name: Debug Notifications
          - entity: input_boolean.ha1_debug_freeze_optimizers
            name: Freeze Optimizers

      - type: entities
        title: üß† System Status (diagnostics_1_3)
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_net_grid_power_kw
            name: Net Grid Power (kW)
          - entity: sensor.huawei_battery_soc
            name: Huawei Battery SOC (%)
          - entity: sensor.ehxdyl83_power
            name: EV Charger Power
          - entity: sensor.ha1_price_current
            name: Current Price
          - entity: sensor.ha1_interval_power_real
            name: Interval Power (Real)
          - entity: input_boolean.ha1_peak_shaving_enabled
            name: Peak Shaving Enabled
          - entity: sensor.ha1_status_price_level
            name: Price Level
          - entity: binary_sensor.ha1_status_peak_near_limit
            name: Peak Near Limit?

  - title: HA1 Status
    path: ha1-status
    icon: mdi:clipboard-pulse
    cards:
      - type: markdown
        content: |
          # üìã HA1 System Status
          Task 18 snapshot of HA1.3 core sensors, peak trackers and helper overrides.

      - type: entities
        title: ‚ö° Core Power & Flow
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_power_consumption_total_kw
            name: House Total Load (kW)
          - entity: sensor.ha1_power_consumption_core_kw
            name: House Core Load (kW)
          - entity: sensor.ha1_power_net_load_kw
            name: Grid Net Load (kW)
          - type: divider
          - entity: sensor.ha1_flow_grid_import
            name: Grid Import (W)
          - entity: sensor.ha1_flow_grid_export
            name: Grid Export (W)
          - entity: sensor.ha1_flow_ev_charging_power
            name: EV Charging Flow (W)
          # - entity: sensor.ha1_ev_share_of_house_load_pct
          #   name: EV Share of House Load (%)  # TODO: reintroduce EV share metric in energy_metrics_1_3.yaml
          - entity: sensor.ha1_power_balance_error_abs
            name: Model Balance Error (W)
          - entity: binary_sensor.ha1_flag_power_balance_bad
            name: Model Balance Problem?

      - type: entities
        title: üîã Huawei Solar & Battery
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_huawei_solar_power
            name: Huawei Solar Power (kW)
          - entity: sensor.ha1_huawei_grid_power
            name: Huawei Grid Power (kW)
          - entity: sensor.ha1_huawei_battery_power
            name: Huawei Battery Power (kW)
          - entity: sensor.ha1_huawei_battery_soc
            name: Huawei Battery SOC (%)
          - entity: binary_sensor.ha1_huawei_battery_charging
            name: Battery Charging?
          - entity: binary_sensor.ha1_huawei_battery_discharging
            name: Battery Discharging?
          - type: divider
          - entity: sensor.ha1_huawei_solar_energy_today
            name: Solar Energy Today (kWh)
          - entity: sensor.ha1_huawei_battery_energy_charged_today
            name: Battery Charged Today (kWh)
          - entity: sensor.ha1_huawei_battery_energy_discharged_today
            name: Battery Discharged Today (kWh)
          - type: divider
          - entity: number.battery_grid_charge_maximum_power
            name: Grid Charge Limit (W)
          - entity: number.battery_maximum_charging_power
            name: Total Charge Limit (W)
          - entity: input_boolean.ha1_battery_allow_grid_charge
            name: Allow Grid Charge
          - entity: input_boolean.ha1_battery_peak_support_enabled
            name: Peak Support Enabled

      - type: entities
        title: üöó EV Charger & Vehicle
        show_header_toggle: false
        entities:
          - entity: binary_sensor.ev_is_charging
            name: EV Charging?
          - entity: sensor.ev_charger_power
            name: EV Charger Power (kW)
          - entity: sensor.ev_charger_power_w
            name: EV Charger Power (W)
          - entity: sensor.ev_charger_current
            name: Charger Current (A)
          - entity: sensor.ev_charger_current_limit
            name: Charger Current Limit (A)
          - type: divider
          - entity: sensor.ev_session_energy
            name: Session Energy (kWh)
          - entity: sensor.ev_charging_time_left
            name: Charging Time Left
          - entity: sensor.ev_battery_soc
            name: EV Battery SOC (%)
          - entity: sensor.ev_estimated_range
            name: EV Estimated Range (km)
          - type: divider
          - entity: input_number.ha1_ev_limit_current_a
            name: EV Current Limit Helper (A)
          - entity: input_boolean.ha1_force_ev_charge_now
            name: Force Charge Now
          - entity: input_boolean.ha1_control_ev_auto
            name: EV Automations Enabled
          - entity: input_boolean.ha1_ev_obey_peak_limit
            name: Obey Peak Limit

      - type: entities
        title: üìà Peak & Utility Summary
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_peak_billable_power_kw
            name: Peak Billable Power (kW)
          - entity: sensor.ha1_peak_power_interval_cost_adjusted
            name: Peak Interval (Cost-Adjusted)
          - entity: sensor.ha1_peak_power_interval_real
            name: Peak Interval (Real)
          - entity: sensor.ha1_monthly_peak_power_real_history_max_2
            name: Monthly Peak (Real)
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Monthly Peak (Billable Top3)  # TODO: ensure entity slug matches template after HA reload
          - entity: sensor.ha1_monthly_peak_cost_estimated
            name: Monthly Peak Cost (SEK)
          - type: divider
          - entity: sensor.ha1_grid_import_energy_daily
            name: Grid Import Daily (kWh)
          - entity: sensor.ha1_grid_import_energy_monthly
            name: Grid Import Monthly (kWh)
          - entity: sensor.ha1_grid_export_energy_daily
            name: Grid Export Daily (kWh)
          - entity: sensor.ha1_grid_export_energy_monthly
            name: Grid Export Monthly (kWh)
          - type: divider
          - entity: input_number.ha1_daily_peak_power_cost_adjusted
            name: Daily Peak (Helper)
          - entity: input_number.ha1_peak_limit_kw
            name: Peak Limit (kW)
          - entity: input_number.ha1_peak_warning_kw
            name: Peak Warning (kW)
          - entity: input_select.ha1_peak_interval_mode
            name: Peak Interval Length
          - entity: input_number.ha1_month_peak_top1_kw
            name: Month Peak #1
          - entity: input_number.ha1_month_peak_top2_kw
            name: Month Peak #2
          - entity: input_number.ha1_month_peak_top3_kw
            name: Month Peak #3
          - entity: input_number.ha1_peak_tariff_price_per_kw
            name: Peak Tariff Price (SEK/kW)
          - entity: input_text.ha1_peak_tariff_agreement_name
            name: Tariff Agreement Name

      - type: entities
        title: üéõÔ∏è System Helpers & Overrides
        show_header_toggle: false
        entities:
          - entity: input_boolean.ha1_automation_master_enabled
            name: Master Automation Enable
          - entity: input_boolean.ha1_peak_shaving_enabled
            name: Peak Shaving Enabled
          - entity: input_boolean.ha1_control_battery_auto
            name: Battery Automations Enabled
          - entity: input_boolean.ha1_control_ev_auto
            name: EV Automations Enabled
          - entity: input_boolean.ha1_battery_allow_grid_charge
            name: Allow Grid Charge
          - entity: input_boolean.ha1_battery_peak_support_enabled
            name: Battery Peak Support
          - entity: input_boolean.ha1_force_battery_charge_from_grid_now
            name: Force Battery Grid Charge Now
          - entity: input_boolean.ha1_force_ev_charge_now
            name: Force EV Charge Now
          - entity: input_boolean.ha1_comfort_override_enabled
            name: Comfort Override Enabled
          - entity: input_boolean.ha1_allow_high_price_heating
            name: Allow High-Price Heating
          - entity: input_boolean.ha1_debug_energy_logic
            name: Debug Energy Logic
          - entity: input_boolean.ha1_debug_notifications_enabled
            name: Debug Notifications Enabled
          - entity: input_boolean.ha1_debug_freeze_optimizers
            name: Freeze Optimizers
          - type: divider
          - entity: input_number.ha1_battery_min_soc_normal
            name: Battery Min SOC (Normal)
          - entity: input_number.ha1_battery_max_soc_target
            name: Battery Max SOC Target
          - entity: input_number.ha1_batt_peak_shaving_soc
            name: Battery Peak Shaving SOC
          - entity: input_number.ha1_batt_grid_charge_cutoff_soc
            name: Battery Grid Charge Cutoff SOC
          - entity: input_number.ha1_batt_grid_charge_max_kw
            name: Battery Grid Charge Max (kW)
