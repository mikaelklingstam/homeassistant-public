# --- HomeAssistant 1.3 – User-Facing Energy Overview ---
# File: dashboards/ha1_energy_overview.yaml
# Dashboard: HA1 – Energy Overview  (id: ha1-energy-overview)
#
# Purpose:
# Clean, user-facing daily driver view for energy status and basic controls.
# Shows: Solar → Battery → House → EV → Grid, plus price, peaks, overrides.

title: "HA1 – Energy Overview"

views:
  - title: "HA1 – Energy Overview"
    path: ha1-energy-overview
    icon: mdi:home-battery
    type: masonry

    cards:

      # --- HA1 – Energy Overview: Status & price strip ----------------------
      - type: glance
        title: "Status"
        entities:
          - entity: sensor.ha1_net_grid_power
            name: Net grid
          - entity: input_boolean.ha1_automations_master_enable
            name: Automations
          - entity: input_boolean.ha1_peak_shaving_enabled
            name: Peak shaving
          - entity: input_boolean.ha1_comfort_override_enabled
            name: Comfort

      - type: glance
        title: "Price & peak"
        entities:
          - entity: sensor.nordpool_kwh_se3_sek_3_10_025
            name: Nordpool
          - entity: sensor.ha1_status_price_level
            name: Price level
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Peak (adjusted)

      # --- HA1 – Energy Overview: Flows & core metrics ----------------------
      - type: entities
        title: "Energy flows – Solar → Battery → House → EV → Grid"
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_power_solar_ac
            name: Solar production (AC)
          - entity: sensor.ha1_power_battery_net
            name: Battery power (net)
          - entity: sensor.ha1_huawei_battery_soc
            name: Battery state of charge
          - entity: sensor.ha1_power_house_total
            name: House consumption
          - entity: sensor.ha1_power_ev_charger
            name: EV charging power
          - entity: sensor.ha1_net_grid_power
            name: Net grid import/export

      - type: glance
        title: "Flows snapshot"
        entities:
          - entity: sensor.ha1_power_solar_ac
            name: Solar
          - entity: sensor.ha1_power_battery_net
            name: Battery
          - entity: sensor.ha1_power_ev_charger
            name: EV
          - entity: sensor.ha1_net_grid_power
            name: Grid

      # --- HA1 – Energy Overview: EV panel ----------------------------------
      - type: entities
        title: "EV – Charging & Mode"
        show_header_toggle: false
        entities:
          - entity: input_select.ha1_ev_charging_mode
            name: EV charging mode
          - entity: switch.ehxdyl83_charger_enabled
            name: Charger output (Easee)
          - entity: sensor.ha1_power_ev_charger
            name: EV charger power
          - entity: sensor.ev_charging_time_left   # sensor.id4pro_charging_time_left
            name: ID.4 – time left

          # EV battery SOC (alias of ID.4 level):
          - entity: sensor.ev_battery_soc
            name: EV battery SOC

          # EV charging limit (kW):
          - entity: input_number.ha1_ev_max_charging_power_kw
            name: EV charging limit (kW)

          # Derived EV max current (A) from conversion package:
          - entity: sensor.ha1_ev_max_charging_current_2
            name: EV max current (A)

      # --- HA1 – Energy Overview: Battery panel -----------------------------
      - type: entities
        title: "Battery – SOC, power & grid charge"
        show_header_toggle: false
        entities:
          - entity: sensor.ha1_huawei_battery_soc
            name: Battery state of charge
          - entity: sensor.ha1_power_battery_net
            name: Battery power (net)
          - entity: input_number.ha1_battery_grid_charge_limit_kw
            name: Max grid charge power (kW)
          - entity: input_number.ha1_battery_min_soc_normal
            name: Min SOC – normal mode
          - entity: input_number.ha1_batt_peak_shaving_soc
            name: Min SOC – peak mode

      # --- HA1 – Energy Overview: Peaks & cost ------------------------------
      - type: entities
        title: "Peaks & cost"
        show_header_toggle: false
        entities:
          - entity: input_number.ha1_peak_limit_kw
            name: Monthly peak limit (kW)
          - entity: input_number.ha1_peak_warning_kw
            name: Peak warning (kW)
          - entity: input_number.ha1_peak_warning_margin_kw
            name: Peak warning margin (kW)
          - entity: sensor.ha1_monthly_peak_power_real_history_max_2
            name: Current monthly peak (raw)
          - entity: sensor.ha1_monthly_peak_power_cost_adjusted
            name: Monthly peak (cost-adjusted)

      # --- HA1 – Energy Overview: Mini history ------------------------------
      - type: history-graph
        title: "History – Net grid, price & battery SOC"
        hours_to_show: 4
        refresh_interval: 60
        entities:
          - entity: sensor.ha1_net_grid_power
            name: Net grid power
          - entity: sensor.nordpool_kwh_se3_sek_3_10_025
            name: Nordpool price
          - entity: sensor.ha1_huawei_battery_soc
            name: Battery SOC
